<apex:page standardcontroller="Opportunity" extensions="PIP_QA_on_OpportunityController" >
	
	<script type="text/javascript" src="{!URLFOR($Resource.JQuery)}"></script>
	
	<script type="text/javascript">  
		
		var $ = jQuery.noConflict();
		
		var PIP_QA_on_OpportunityProductPage = function() {
			
			var strOpportunityIdd = '';
			
			var init = function(OppId) {
				
				console.log('==OppId=='+OppId);
				strOpportunityIdd = OppId;
				fetchClientQA(strOpportunityIdd);
			}
			
			/*var refreshPage = function() {
			
				$('#something').click(function() {
    				location.reload();
				});	
			}*/
			return{
			
				init: init
				//refreshPage: refreshPage
			}
			
		}();
		
		$(document).ready(function() {
			
			console.log('==comes in onLoad==');
			console.log('==cstrOpportunityIdd=='+'{!strOpportunityIdd}');
			PIP_QA_on_OpportunityProductPage.init('{!strOpportunityIdd}');
			//populateAnswer_ifAlreadyPresent();
		});
		
	</script>
	<apex:form >
	
		<apex:actionFunction name="fetchClientQA" action="{!fetchClientQuestionsAnsAnswers}" rerender="QATable">
	        <apex:param name="strOpportunityId" value="" assignTo="{!strOpportunityIdd}" />
    	</apex:actionFunction>
    	
    	<!-- <apex:actionFunction name="populateAnswer_ifAlreadyPresent" action="{!populateAnswers}" rerender="QATable">
    	</apex:actionFunction>-->
    
		<apex:pageBlock >
			<apex:pageBlockButtons > 
				<apex:commandButton value="Submit" action="{!Submit}" />   
                <apex:commandButton value="cancel" action="{!Cancel}" />     
			</apex:pageBlockButtons>
			<apex:pageBlockTable id="QATable" value="{!lstQuestionAnswers}" var="table">
				
				<apex:column >
					<apex:facet name="header"> Product Group </apex:facet>
					<apex:outputText value="{!table.strProductGroupName}"/>
				</apex:column>
				
				<apex:column >
					<apex:facet name="header"> Product </apex:facet>
					<apex:outputText value="{!table.strProductName}"/>
				</apex:column>
				
				<apex:column >
					<apex:facet name="header"> Questions and Answers</apex:facet>
					<apex:pageBlockTable id="QWrapperTable" value="{!table.lstQuestobject}" var="QuesTable">
						
						<apex:column >
							<apex:outputText value="{!QuesTable.QuestionText__c}"/>
						</apex:column>
							
						<apex:column rendered="{!if(QuesTable.Question_Type__c == 'Text Area', true, false)}">
							<apex:inputTextarea id="TextArea" value="{!table.mapAnswers[QuesTable.Id][0].Answer_TextType__c}"/> 
						</apex:column>
						
						<apex:column rendered="{!if(QuesTable.Question_Type__c == 'Picklist', true, false)}">
							 <apex:selectList id="pickQuest" value="{!table.mapOptions[QuesTable.Id]}" size="1" required="true">
  								<apex:selectOptions value="{!table.mapSelectOptions[QuesTable.Id]}"/>
							</apex:selectList>
 						</apex:column>
						
					</apex:pageBlockTable>
				</apex:column>
				
				<!-- <apex:column >
					<apex:facet name="header"> Answers </apex:facet>
					<apex:pageBlockTable id="AWrapperTable" value="{!table.lstQuestobject}" var="AnsTable">
						<apex:column rendered="{!if(AnsTable.Question_Type__c == 'Text Area', true, false)}">
<!-- 							 <apex:inputTextarea id="TextArea" value="{!table.mapAnswers[AnsTable.Id].Answer_TextType__c}"/> -->
<!-- 								<apex:inputTextarea id="TextArea" /> -->
							<!-- <apex:outputText value="{!AnsTable.Answer_TextType__c}"/>-->
					<!--	</apex:column>
						
						<apex:column rendered="{!if(AnsTable.Question_Type__c == 'Picklist', true, false)}">
							<apex:selectList id="pickQuest" value="{!table.mapOptions[AnsTable.Id]}" size="1" required="true">
  								<apex:selectOptions value="{!table.mapSelectOptions[AnsTable.Id]}"/>
							</apex:selectList>
							<!-- <apex:outputText value="{!AnsTable.Answer_TextType__c}"/>-->
<!-- 						</apex:column> -->
						
<!-- 						<apex:column rendered="{!if(AnsTable.Question__r.Question_Type__c == 'Radio Button', true, false)}"> -->
							
							<!-- <apex:outputText value="{!AnsTable.Answer_TextType__c}"/>-->
<!-- 						</apex:column> -->
						
					<!-- </apex:pageBlockTable>
				</apex:column>-->
				
			</apex:pageBlockTable>
			<br/>
 			<apex:outputPanel >
	        	<apex:outputText value="Total No.Questions : " />
<!-- 	            	<span id="NoQuestions" name="NoQuestions"> {!TotalAnswer} </span>  -->
						<apex:outputText value="{!TotalAnswer}"/>
	        </apex:outputPanel> <br/><br/>
	        
	        <apex:outputPanel >
	        	<apex:outputText value="No.Questions Answered : " />
<!-- 	            	<span id="NoAnsweredQuestions" name="NoAnsweredQuestions"> {!TotalAnsweredField} </span>  -->
	        </apex:outputPanel> <br/><br/>
	        
	        <apex:outputPanel >
	        	<apex:outputText value="No.Questions Not Answered : " />
<!-- 	            	<span id="NoUnAnsweredQuestions" name="NoUnAnsweredQuestions">  </span>  -->
	        </apex:outputPanel> <br/><br/> 
	        
		</apex:pageBlock>
	</apex:form>
</apex:page>